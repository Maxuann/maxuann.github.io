<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="index.css">
  <title>大富翁水印工具</title>
</head>

<body>
  <div id="app">
    <input type="file" id="fileInput" multiple accept="image/*">
    <div id="content">
      <div class="item" v-for="item in images">
        <div>
          <img v-for="item in 3" src="logo.png">
        </div>
        <img class="bg" :src="item.currentSrc" alt="">
      </div>
    </div>
  </div>
</body>
<script>
  new Vue({
    el: '#app',
    data: {
      images: []
    },
    methods: {
      handleFileUpload(event) {
        // 每次上传前清空上次文件
        this.images = []
        //将每个文件推入images数组
        const files = event.target.files;
        for (let i = 0; i < files.length; i++) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.src = e.target.result;
            img.onload = () => {
              this.images.push(img);
            };
          };
          reader.readAsDataURL(files[i]);
        }
        setTimeout(() => {
          // 将每个content下的成员保存到本地
          const content = document.getElementById('content');
          const children = content.children;

          Array.from(children).forEach(child => {
            html2canvas(child).then(canvas => {
              const imgData = canvas.toDataURL('image/png');
              const link = document.createElement('a');
              link.href = imgData;
              link.download = '水印.png';
              link.click();
              console.log('保存');
            });
          });
        }, 500);
      }
    },
    mounted() {
      document.getElementById('fileInput').addEventListener('change', this.handleFileUpload);
    }
  });

</script>

</html>
