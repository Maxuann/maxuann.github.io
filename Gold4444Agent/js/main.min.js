var loadCount=0;function initJS(){loadCount=0;for(var e=0;e<COMMON_JS_LIST.length;e++){loadJS(COMMON_JS_LIST[e],loadOK,loadNG,false)}}function loadJS(e,n,r,t){if(typeof t=="undefined"){t=false}var o=document.createElement("script");var i=t?"js_oss/"+e:JS_BASE+e;o.setAttribute("src",i);document.head.appendChild(o);o.onload=function(){if(n){n()}};o.onerror=function(){if(r){r(e,t)}}}function loadOK(){loadCount++;checkFinishLoadJS()}function loadNG(e,n){if(!n){loadJS(e,loadOK,loadNG,true)}}function checkFinishLoadJS(){if(loadCount===COMMON_JS_LIST.length){loadJSFinished()}}function loadOSSImage(){var e=document.querySelectorAll("img[data-src]");for(var n=0;n<e.length;n++){var r=isLoadOSS?FILE_PARTNER+"/":"";r+=IMAGE_OSS+e[n].getAttribute("data-src");e[n].src=r;e[n].onerror=function(){var e=this;e.src=IMAGE_OSS+e.getAttribute("data-src");e.onerror=null}}}function checkOpenServer(){var e=new Date;if(e>=openSeverDate){clearTimerOpen();connectDownload()}else{}}var timerOpen=null;function checkSever(){if(isConnectServer){connectServer(true)}else{finishedRequest()}}function openServer(){var e=new Date;if(e<openSeverDate){timerOpen=setInterval(checkOpenServer,1e3)}else{clearTimerOpen()}}function clearTimerOpen(){if(timerOpen){clearInterval(timerOpen)}}function isMobile(){var e=window.navigator.userAgent.indexOf("Mobile")>-1;return e}function isAndroid(){var e=navigator.userAgent;return e.indexOf("Android")>-1||e.indexOf("Linux")>-1}function isIOS(){var e=navigator.userAgent;return!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}function isWeixin(){var e=navigator.userAgent.toLowerCase();return e.match(/MicroMessenger/i)=="micromessenger"}function isQQ(){var e=navigator.userAgent.toLowerCase();return e.match(/QQ/i)=="qq"&&e.match(/qqtheme/i)=="qqtheme"}function isWeixinQQ(){return isWeixin()||isQQ()}function isMobileView(){var e=getViewSizeWithScrollbar().width;return e<=MOBILE_WIDTH}function getViewSizeWithScrollbar(){if(window.innerWidth){return{width:window.innerWidth,height:window.innerHeight}}else if(document.documentElement.offsetWidth==document.documentElement.clientWidth){return{width:document.documentElement.offsetWidth,height:document.documentElement.offsetHeight}}else{return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}}function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)";var replaceText=arg+"="+arg_val;if(url.match(pattern)){var tmp="/("+arg+"=)([^&]*)/gi";tmp=url.replace(eval(tmp),replaceText);return tmp}else{if(url.match("[?]")){return url+"&"+replaceText}else{return url+"?"+replaceText}}}function getPhoneString(){var e=document.createElement("canvas"),n=e.getContext("experimental-webgl"),r=n.getExtension("WEBGL_debug_renderer_info");var t=navigator.userAgent;var o=t.indexOf("Android");if(o>=0){var i=t.indexOf(";",o);var a=t.substring(o,i).trim();var l=t.indexOf("Build",i+1);if(l<=i){l=t.indexOf(";",i+1)}var d=t.substring(i+1,l).trim();var c=d.split(";");var u=c[c.length-1].trim();var s=n.getParameter(r.UNMASKED_RENDERER_WEBGL)+";"+a+";"+u;return s}var f=t.indexOf("iPhone OS");if(f>=0){var i=t.indexOf("like",o);var u=t.substring(f,i).trim();return u+";"+window.screen.width+";"+window.screen.height}return""}var COMMON_JS_LIST=["jquery.min.js","clipboard.min.js","qrcode.min.js"];var iosDownloadUrl=IOS_URL_DEF;var iosSuperUrl="";var androidDownloadUrl=ANDROID_URL_DEF;var h5Url="";var customerUrl=CUSTOMER_URL_DEF;var isGetDownloadUrl=false;var clickDownloadURL="";function loadJSFinished(){initView()}function connectServer(t){var o=new XMLHttpRequest;o.open("get",CONNECT_URL+PID);o.send();o.onreadystatechange=function(){if(o.readyState==4){if(o.status==200){var e=JSON.parse(o.responseText);if(e.err==0){if(t&&e.android_url!=null&&e.android_url.length>0){androidDownloadUrl=decodeURIComponent(e.android_url)}var n=[];if(t&&e.ios_url!=null&&e.ios_url.length>0){n.push(decodeURIComponent(e.ios_url))}if(t&&e.ios_super_url!=null&&e.ios_super_url.length>0){n.push(decodeURIComponent(e.ios_super_url))}if(t&&e.ios_tf_url!=null&&e.ios_tf_url.length>0){n.push(decodeURIComponent(e.ios_tf_url))}if(n.length>0){iosDownloadUrl=n[0]}if(n.length>1){iosSuperUrl=n[1]}if(e.cs_url!=null&&e.cs_url.length>0){customerUrl=decodeURIComponent(e.cs_url)}if(e.base_url!=null&&e.base_url.length>0){FILE_BASE=decodeURIComponent(e.base_url)}if(e.partner_url!=null&&e.partner_url.length>0){FILE_PARTNER=decodeURIComponent(e.partner_url)+"/"+PID}if(e.h5_url!=null&&e.h5_url.length>0){h5Url=decodeURIComponent(e.h5_url)}if(e.open_time!=null&&e.open_time>0){openSeverDate=new Date(e.open_time*1e3)}if(isIOS()&&iosSuperUrl&&iosSuperUrl.length>0){var r=document.getElementById("downIosSuper");r&&r.classList.remove("hide")}}}finishedRequest()}}}window.onload=function(){checkWeixin();window.onresize=function(){resizePageView()};loadRes();if(!isConnectServer){startCheckOpenServer()}};function loadRes(){loadOSSImage();initJS()}function finishedRequest(){isGetDownloadUrl=true;if(clickDownloadURL.length>0){window.location.href=clickDownloadURL}startCheckOpenServer()}function checkWeixin(){if(isWeixin()||isQQ()){var e=document.getElementById("weChat");e.style.display=""}}function initView(){var e=window.location.href;var n=getParameterByName("qrcodeurl");if(n!=null){e=decodeURIComponent(n)}if(document.getElementById("qrcodeTable")){var r=new QRCode(document.getElementById("qrcodeTable"),{width:140,height:140,text:e})}$("#qrcodeTable")&&$("#qrcodeTable").show();$(".qrcode-text")&&$(".qrcode-text").show();initClipboard()}var onClickCustomer=function(){if(isMobileView()){window.open(customerUrl)}else{var e=820;var n=650;var r=(window.screen.availHeight-30-n)/2;var t=(window.screen.availWidth-10-e)/2;var o=window.open("about:blank","_blank","height=650, width=820,toolbar=no,scrollbars=no,menubar=no,status=no,top="+r+", left="+t+"");if(customerUrl){o.location.href=customerUrl}else{o.close()}}};var iosBtn=function(){window.open(iosDownloadUrl)};var androidBtn=function(){window.open(androidDownloadUrl)};function initClipboard(){var e=function(e,n){if(e==null||e.length<1)return;var r=new ClipboardJS(e,{text:function(){var e=getKey();if(e==null||e.length<1){gotoDownload(n);return""}else{return e}}});r.on("success",function(e){gotoDownload(n)});r.on("error",function(e){gotoDownload(n)})};var n=document.querySelectorAll(".android-btn");e(n,"2");var r=document.querySelectorAll(".ios-btn");e(r,"1");var t=document.getElementById("phoneDownload");e(t,isIOS()?"1":"2");var o=document.getElementById("downIosSuper");o&&e(o,isIOS()?"3":"2")}function getKey(){if(getUidByDomain()!=""){return getUidByDomain()}return getParameterByName("key")}function getParameterByName(e,n){if(!n)n=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=r.exec(n);if(!t)return null;if(!t[2])return"";return decodeURIComponent(t[2].replace(/\+/g," "))}function getUidByDomain(){var e="";if(!domainUidConfig)return e;for(k in domainUidConfig){if(document.domain.indexOf(k)>=0){e=domainUidConfig[k];break}}return e}function postWebPhoneString(){var e=getKey();var n=getPhoneString();if(e!=null&&n!=""){var r=new XMLHttpRequest;r.open("post",SHARE_URL);var t={};t.pid=PID;t.data=n;t.key=e;r.send(JSON.stringify(t))}}function gotoDownload(e){if(isConnectServer){gotoSeverDownload(e)}else{gotoLocalDownload(e)}}function gotoSeverDownload(e){var n="";if(e==="1"){n=iosDownloadUrl}else if(e==="2"){n=androidDownloadUrl}else if(e==="3"){n=iosSuperUrl}if(isGetDownloadUrl==false){clickDownloadURL=n;alert("正在获取下载地址，请稍候重试。");return}window.parent.location.href=n}function gotoLocalDownload(e){var n="";var r=new Date;if(checkOpenServer()){if(e==="1"){n=IOS_URL_DEF}else if(e==="2"){n=ANDROID_URL_DEF}else if(e==="3"){n=IOS_URL_DEF}if(n==""){location.reload(true)}else{window.parent.location.href=n}}else{console.log("还未到开服时间")}}function resizePageView(){}function connectDownload(){var e=document.getElementById("phoneDownload");var n=new Date;var r=checkOpenServer();if(isTestDownload)r=true;if(e){if(r&&h5Url.length>0){e.classList.remove("hide")}else{e.classList.add("hide")}}}function checkOpenServer(){var e=new Date;return e>=openSeverDate}function startCheckOpenServer(){connectDownload();openServer()}function onClickH5Download(){if(h5Url&&h5Url.length>0){var e=h5Url;var n=getParameterByName("key");if(n!=null){if(e.indexOf("?")<0){e+="?"}else{e+="&"}e+="key="+n}window.parent.open(e)}}